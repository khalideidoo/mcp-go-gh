package main

const commandTemplate = `// Code generated by tools/gen. DO NOT EDIT.
package generated

import (
	"context"
	"fmt"
	"github.com/modelcontextprotocol/go-sdk/mcp"
	"github.com/khalideidoo/mcp-go-gh/internal/executor"
)

{{range .Subcommands}}
// {{toTitle $.Command}}{{toTitle .Name}}Args defines parameters for gh {{$.Command}} {{.Name}}
type {{toTitle $.Command}}{{toTitle .Name}}Args struct {
	{{range nonPositional .Parameters -}}
	{{toTitle .Name}} {{goType .}} ` + "`" + `{{jsonTag .}} {{schemaTag .}}` + "`" + `
	{{end}}
	{{range positionalArgs .Parameters -}}
	{{toTitle .Name}} {{goType .}} ` + "`" + `{{jsonTag .}} {{schemaTag .}}` + "`" + `
	{{end}}
}

// Register{{toTitle $.Command}}{{toTitle .Name}}Tool registers the gh {{$.Command}} {{.Name}} tool
func Register{{toTitle $.Command}}{{toTitle .Name}}Tool(server *mcp.Server, exec *executor.Executor) {
	mcp.AddTool(server, &mcp.Tool{
		Name: "gh_{{$.Command}}_{{toSnake .Name}}",
		Description: "{{.Description}}",
	}, func(ctx context.Context, req *mcp.CallToolRequest, args {{toTitle $.Command}}{{toTitle .Name}}Args) (*mcp.CallToolResult, any, error) {
		cmd := []string{"{{$.Command}}", "{{.Name}}"}

		{{range positionalArgs .Parameters -}}
		// Add positional argument: {{.Name}}
		{{if eq .Type "array" -}}
		cmd = append(cmd, args.{{toTitle .Name}}...)
		{{else if eq .Type "string" -}}
		if args.{{toTitle .Name}} != "" {
			cmd = append(cmd, args.{{toTitle .Name}})
		}
		{{else -}}
		if args.{{toTitle .Name}} != "" {
			cmd = append(cmd, args.{{toTitle .Name}})
		}
		{{end}}
		{{end}}

		{{range nonPositional .Parameters -}}
		{{if eq .Type "boolean" -}}
		if args.{{toTitle .Name}} {
			cmd = append(cmd, "{{.Flag}}")
		}
		{{else if eq .Type "integer" -}}
		if args.{{toTitle .Name}} > 0 {
			cmd = append(cmd, "{{.Flag}}", fmt.Sprintf("%d", args.{{toTitle .Name}}))
		}
		{{else if eq .Type "array" -}}
		for _, v := range args.{{toTitle .Name}} {
			cmd = append(cmd, "{{.Flag}}", v)
		}
		{{else if eq .Type "map" -}}
		for k, v := range args.{{toTitle .Name}} {
			cmd = append(cmd, "{{.Flag}}", fmt.Sprintf("%s=%s", k, v))
		}
		{{else -}}
		if args.{{toTitle .Name}} != "" {
			cmd = append(cmd, "{{.Flag}}", args.{{toTitle .Name}})
		}
		{{end}}
		{{end}}

		result, err := exec.Execute(ctx, cmd...)
		if err != nil {
			return nil, nil, fmt.Errorf("gh {{$.Command}} {{.Name}} failed: %w", err)
		}

		return &mcp.CallToolResult{
			Content: []mcp.Content{
				&mcp.TextContent{Text: result.Stdout},
			},
		}, nil, nil
	})
}

{{end}}
`

const registryTemplate = `// Code generated by tools/gen. DO NOT EDIT.
package generated

import (
	"github.com/modelcontextprotocol/go-sdk/mcp"
	"github.com/khalideidoo/mcp-go-gh/internal/executor"
)

// RegisterAllTools registers all generated gh command tools
func RegisterAllTools(server *mcp.Server, exec *executor.Executor) {
	{{range $cmd := . -}}
	{{range .Subcommands -}}
	Register{{toTitle $cmd.Command}}{{toTitle .Name}}Tool(server, exec)
	{{end}}
	{{end}}
}
`
